<!--new -->
<html>
	<head>
		<script src="/socket.io/socket.io.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="https://cdn.jsdelivr.net/clipboard.js/1.5.12/clipboard.min.js"></script>
<script>
  var socket = io();
  var isLive = false;

  var announcementsarr = [];
function myFunction() {}
  function startpoll()
  {
  	socket.emit('newpoll', [document.getElementById("choice1").value,document.getElementById("choice2").value,document.getElementById("choice3").value,document.getElementById("choice4").value], document.getElementById("mySelect").value - 1,document.getElementById("confirm").value, document.getElementById("prompt").value);
  }

  socket.on('poll', function(arg, otherarg, thirdarg){ // (The arguments don't matter here)
  	document.getElementById("startbutton").style.visiblity = 'hidden';
  	document.getElementById("endvotediv").style.visibility = 'visible';
  	document.getElementById("pollstatus").style.visibility = 'visible';
  });

  socket.on('pollupdate', function(text) {
  	document.getElementById('pollstatus').innerHTML = text;
  });

  	socket.on('live', function(){
  		isLive = true;
  		document.getElementById("polldiv").style.visibility = 'visible';
  		document.getElementById("livebutton").style.visibility = 'hidden';
  		document.getElementById("offairbutton").style.visibility = 'visible';
  	});

  	socket.on('results', function(arg)
  	{
  		document.getElementById("startbutton").style.visiblity = 'visible';
  		document.getElementById("endvotediv").style.visibility = 'hidden';
  		document.getElementById("pollstatus").style.visibility = 'hidden';
  });

  	socket.on('error', function(msg)
  	{
  		alert(msg);
  	})


  	socket.on("msg", function(m)
  	{
  		alert(m);
  	});

  	function doLogin()
  	{
  		socket.emit('login', document.getElementById("confirm").value);
  	}

 	function golive()
 	{
 		socket.emit('golive', document.getElementById("confirm").value);
 		//listener();
 	}

 	function gooffair()
 	{
 		socket.emit('gooffair', document.getElementById("confirm").value);
 	}

	function restartserver()
	{
		socket.emit('restart', document.getElementById("confirm").value);
	}

 	socket.on('notauthed', function(){
 		alert("404: Access denied");
 	});

 	function endvote() {
 		socket.emit('endpoll', document.getElementById("confirm").value);
 	}

 	socket.on('loggedin', function(){
 		document.getElementById("logindiv").style.visibility = 'hidden';
 	})

 	socket.on('notloggedin', function(){
 		document.getElementById("loginfailed").innerHTML = "Wrong password";
 	})

 	socket.on('offair', function()
 	{
 		document.getElementById("livebutton").style.visibility = 'visible';
  		document.getElementById("offairbutton").style.visibility = 'hidden';
 	})

 	socket.on("announcements", function(data)
 	{
 		var anns = []; // (announcements)
 		var idtxt = ""
 		// Split data on colons (into announcement sets)
 		var arr = data.split(";")
 		// Loop through array and split each index on / 
 		for(var i = 0; i < arr.length; i++)
 		{
 			var litoadd = "<li class=\"list-group-item\">";
 			var subarr = arr[i].split("/");
 			if(subarr.length == 5)
 			{ 
 				litoadd += "Title: <strong>" + subarr[1] + "</strong><br>" + "Creator/Club: " + subarr[0] + "<br>" + "Description: " + subarr[2] + "<br>" + "<i>Date: " + subarr[3] + " | " + "Image: " + linkForImage(subarr[4]) + "</i><br><strong><a onclick=\"removeByID(" + i + ")\">Delete</a></strong>";
 				var thisannouncement = new Announcement(subarr[2], subarr[1], subarr[0], subarr[4], subarr[3]);
 				anns.push(thisannouncement);
 			} else {
 				litoadd += "{ Syntax error in announcement file, item #" + (i+1) + " }"; 
 			}

 			idtxt += litoadd + "</li>";

 		}

 		document.getElementById("announcementslist").innerHTML = idtxt;
 		announcementsarr = anns;
 	});

 	socket.on('videos', function(vs)
 	{
 		var vids = vs.split(",");
 		var ulhtml = "";
 		for(var i = 0; i < vids.length; i++)
 		{
 			var link = "https://www.youtube.com/watch?v=" + vids[i];
 			ulhtml += "<li class=\"list-group-item\"><a href=\"" + link + "\">" + link + " | <a onclick=\"deletevideo('" + link + "')\">Delete Video</a><br><!--<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/" + vids[i] + "\" frameborder=\"0\" allowfullscreen></iframe>--></li>" 
 		}

 		document.getElementById("videos").innerHTML = ulhtml;
 	});

 	socket.on('status', function(text) {
 		document.getElementById("pollstatuslabel").innerHTML = text;
 	});

 	socket.on('alreadypolling', function(){
 		alert("A poll is already running")
 	})

 	function togglecorrect() {
 		var i = document.getElementById("index")
 		if(i == 1)
 		{
 			document.getElementById("correctanswer").innerHTML = document.getElementById("choice1").value;
 		} else if(i == 2)
 		{
 			document.getElementById("correctanswer").innerHTML = document.getElementById("choice2").value;
 		} else if(i == 3)
 		{
 			document.getElementById("correctanswer").innerHTML = document.getElementById("choice3").value;
 		} else {
 			document.getElementById("correctanswer").innerHTML = document.getElementById("choice4").value;
 		}
 	}
 	function refreshchoices()
 	{
 		if(isLive)
 		{
 			document.getElementById("o1").innerHTML = "Choice #1 " + document.getElementById("choice1").value;
 			document.getElementById("o2").innerHTML = "Choice #2 " + document.getElementById("choice2").value;
 			document.getElementById("o3").innerHTML = "Choice #3 " + document.getElementById("choice3").value;
 			document.getElementById("o4").innerHTML = "Choice #4 " + document.getElementById("choice4").value;
 		}
 	}

 	function addvideo()
 	{
 		socket.emit('updatevideos', document.getElementById("newvideo").value, document.getElementById("confirm").value);
 	}

 	function deletevideo(videoToDelete)
 	{
 		socket.emit('removevideo', videoToDelete, document.getElementById("confirm").value);
 	}

 	function addevent()
 	{
 		if(verifyForEvent())
 		{
 			if(document.getElementById("confirm") != "")
 			{
 				socket.emit('newannouncement', get("acreator"),get("atitle"),get("atext"),get("aimage"),(get("ayear") + "-" + get("amonth") + "-" + get("aday") + "-" + get("ahour") + "-" + get("aminute") + "-" + get("aamorpm")), get("confirm"));
 			} else {
 				alert("Please fill in the password field")
 			}
 		} else {
 			alert("something was nil")
 		}
 	}

 	function removeByID(id)
 	{
 		var a = announcementsarr[id];
 		if(a != null)
 		{
 			socket.emit("removeannouncement", a.creator, a.title, a.text, document.getElementById("confirm").value);
 		} else {
 			alert("Announcement nil")
 		}
 	}

 	function get(id)
 	{
 		return document.getElementById(id).value;
 	}
 	function verifyForEvent() {
 		if(get("acreator") != "")
 		{
 			if(get("atitle") != "")
 			{
 				if(get("atext") != "")
 				{
 					if(get("aimage") != "")
 					{
 						if(get("ayear") != "")
 						{
 							if(get("amonth") != "")
 							{
 								if(get("aday") != "")
 								{
 									if(get("ahour") != "")
 									{
 										if(get("aminute") != "")
 										{
 											return true;
 										}
 									}
 								}
 							}
 						}
 					}
 				}
 			}
 		}

 		return false;
 	}
 	// Divs
 	// - controldiv
 	// - polldiv
 	// - endvotediv
 	// - announcementsdiv
 	// - videodiv
 	function showdiv(id)
 	{
 		var divs = ["controldiv", "polldiv", "announcementsdiv", "videodiv", "syncdiv","restartdiv"]
 		for(var i = 0; i < divs.length; i++)
 		{
 			if(divs[i] == id)
 			{
 				document.getElementById(divs[i]).hidden = false;
 			} else {
 				document.getElementById(divs[i]).hidden = true;
 			}
 		}
 	}
 	function loginpage()
 	{
 		showdiv("controldiv")
 	}
 	function pollpage()
 	{
 		showdiv("polldiv")
  	}
 	function announcementspage()
 	{
 		showdiv("announcementsdiv")
 	}
 	function videospage()
 	{
 		showdiv("videodiv");
 	}
 	function syncpage()
 	{
 		showdiv("syncdiv")
 	}

	function restartpage()
	{
		showdiv("restartdiv");
	}

 	function linkForImage(imageLink)
 	{
 		if(imageLink.startsWith("local:"))
 		{
 			return "[ Bundled image ]"
 		} else if(imageLink.startsWith("http")) {
 			return "<img src=\"" + replaceAll("[slash]", "/", imageLink) + "\" height=\"90\" width=\"120\"></img>";
 		} else {
 			return "{ Image Error }";
 		}
 	}

 	function replaceAll(string,withstr,instr)
 	{
 		// Split the string
 		var splitstr = instr.split(string);
 		// Result string
 		var resultstr = "";
 		for(var i = 0; i < splitstr.length; i++)
 		{
 			resultstr += splitstr[i]
 			if(i != (splitstr.length - 1))
 			{
 				resultstr += withstr;
 			}
 		}

 		return resultstr
 	}

 	function gensyncfile()
 	{
 		socket.emit('generatesyncfile', document.getElementById("confirm").value);
 	}

 	socket.on('syncfilecontents', function(contents){
 		document.getElementById("syncfile").innerHTML = contents;
 	})

 	/* Copied from server */
 	var Announcement = function(txt,ttle,c,img,d) {
		this.text = txt.replace(/\//g, "[slash]");
		this.title = ttle.replace("/", "[slash]");
		this.creator = c.replace("/", "[slash]");
		this.date = d;
		this.datestring = d;
		this.image = img.replace(/\//g, "[slash]");
	};
 	/* Utility - from http://stackoverflow.com/a/17606289/4988353 */
 	function escapeDoubleQuotes(str) {
		return str.replace(/\\([\s\S])|(")/g,"\\$1$2"); // thanks @slevithan!
	}
</script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	</head>

	<body onload="loginpage()">
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand">
      						Channel 2 App [LAN Admin]!!      
      </a>
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li class="active"><a onclick="videospage()">Videos</a></li>
        <li class="active"><a onclick="pollpage()">Polling/Trivia</a></li>
        <li class="active"><a onclick="announcementspage()">Announcements</a></li>
        <li class="active"><a onclick="loginpage()">Broadcast Status/Login</a></li>
        <li class="active"><a onclick="syncpage()">Get SyncFile</a></li>
	<li class="active"><a onclick="restartpage()">Restart Server</a></li>	      
     </ul>
         
   </div><!--/.nav-collapse -->
  </div>
</div>
<br>
<br>
	<div id="controldiv">
		<h2>Control Broadcast Status</h2>
		<button onclick="golive()" id="livebutton" class="btn btn-success">Go Live!</button><br>
		<button onclick="gooffair()" id="offairbutton" class="btn btn-danger">End Broadcast!</button><br>
		<div id="logindiv">
			<strong>Password:</strong><br><input type="password" id="confirm" placeholder="Confirmation password">
			<button class="btn btn-primary" onclick="doLogin()">Login</button>
			<p id="loginfailed"></p>
		</div>
	</div>
	
	<div id="polldiv">
		<h3>Create a poll</h3>
		<strong><p>Choices</p></strong>
		<strong> Choice #1 </strong><input type="text" id="choice1">
		<br>
		<strong> Choice #2 </strong><input type="text" id="choice2">
		<br>
		<strong> Choice #3 </strong><input type="text" id="choice3">
		<br>
		<strong> Choice #4 </strong><input type="text" id="choice4">
		<br>
		<strong><p>Question Prompt</p></strong>
		<input type="text" id="prompt">
		<br>
		<strong><p>Pick the Correct Answer</p></strong>
		<a onclick="refreshchoices()">Refresh Choices</a>
		<select id="mySelect" onchange="myFunction()">
  			<option value="0"><p id="o0">No correct answer (Poll)</p></option>
  			<option value="f">Feedback (hides results from users)</option>
 		 	<option id="o1" value="1">Choice #1</option>
 		 	<option id="o2" value="2">Choice #2</option>
 		 	<option id="o3" value="3">Choice #3</option>
 			 <option id="o4" value="4">Choice #4</option>
		</select>
		<input type="number" id="index" onchange="togglecorrect()" hidden> <p id="correctanswer"></p>
		<br>
		<div id="startbutton">
		<button onclick="startpoll()" type="button" class="btn btn-primary">Send poll</button>
		</div>
		<div id="endvotediv">
			<button onclick="endvote()" class="btn btn-default">End Vote/Poll/Trivia</button>
		</div>
		<div id="pollstatus">
			
		</div>
	</div>
	<div id="announcementsdiv">
		<h2>Announcements</h2>
		<ul id="announcementslist" class="list-group"></ul>
		<h3>Add Announcements</h3>
		<div id='addannouncements'>
			<strong>Club/Department: </strong><input type="text" id="acreator" placeholder="Channel 2, Programming Club, Academics Office">
			<br>
			<strong>Title: </strong><input type="text" id="atitle" placeholder="Special Broadcast">
			<br>
			<strong>Full Text/Description: </strong><input type="atext" id="atext" placeholder="On January 1st, 1970 we will have a special broadcast celebrating the start of Unix time">
			<br>
			<strong>Image URL</strong><input type="text" id="aimage" placeholder="http://www.shanahan.org/editor/userUploads/image/About/BSHS%20Seal%20small.png">
			<br>
			<strong>Date: </strong><input type="number" id="amonth" min="1" max="12" placeholder="1">/<input type="number" id="aday" min="1" max="31" placeholder="1">/<input type="number" id="ayear" min="2016" max="2100" placeholder="2016">
			<br>
			<strong>Time: </strong><input type="number" id="ahour" placeholder="12">:<input type="number" id="aminute" placeholder="00"> <select id="aamorpm"><option value="AM">AM</option><option value="PM">PM</option></select>
			<button class="btn btn-success" onclick="addevent()">Submit</button>
		</div>
	</div>
	<br>
	<div id="videodiv">
		<h2>Videos available in-app</h2>
		<hr><input type="text" id="newvideo" placeholder="Add a video">
		<button onclick="addvideo()" class="btn btn-success">Add</button>
		<ul id="videos" class="list-group">

		</ul>
	</div>
	<div id="syncdiv">
		<h2>Server SyncFile</h2>
		<i>Paste this text into the remote server to sync it's config to that of this server</i>
<br>
		<textarea rows="5" cols="50" id="syncfile" placeholder="Please press generate to get your SyncFile"></textarea>
		<br>
		<button class="btn btn-info" onclick="gensyncfile()">Generate</button>
	</div>
	<div id="restartdiv">
		<h2>Restart the server</h2>
		<i>Closes the server, which should result in forever restarting it</i>
		<br>
		<p>If you are sure this is what you want to do <strong><a onclick="restartserver()">Restart the Server</a></strong></p>
</div>
	</body>
</html>
